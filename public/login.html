<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Authentication | NURSA E-HUB 2026</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: url('Image/splash-background.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #212529;
            min-height: 100vh;
        }
        nav {
            background: #ffffff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
            padding: 1rem 0;
            position: sticky; top: 0; z-index: 100;
        }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #198754; display: flex; align-items: center; gap: 0.5rem; }
        .logo img { width: 50px; }
        .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
        .auth-box {
            max-width: 440px; margin: 3rem auto;
            background: #ffffff;
            padding: 2.5rem; border-radius: 1rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            border: 1px solid #dee2e6;
        }
        h2 { text-align: center; color: #198754; margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        input, select {
            width: 100%; padding: 0.9rem; border-radius: 0.5rem;
            border: 1px solid #dee2e6;
            background: #ffffff;
            color: #212529;
        }
        .btn {
            width: 100%; padding: 1rem; background: #198754;
            color: white; border: none; border-radius: 0.5rem;
            font-size: 1.1rem; font-weight: 600; cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover { background: #157347; transform: translateY(-2px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; }
        .error-msg { background: #f8d7da; color: #721c24; padding: 0.75rem; border-radius: 0.5rem; margin-bottom: 1rem; display: none; }
        .links { text-align: center; margin-top: 1.5rem; }
        .links a { color: #198754; text-decoration: underline; cursor: pointer; }
        .section { display: none; }
        .section.active { display: block; }

        #recoveryModal, #loadingSplash {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }
        #loadingSplash.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .modal-content {
            background: white; padding: 2.5rem; border-radius: 1rem;
            text-align: center; max-width: 480px; width: 90%;
        }
        #accessIdDisplay, #recoveryCodeDisplay {
            font-size: 2.1rem; font-weight: bold; letter-spacing: 2px;
            background: #e9f7ef; padding: 1rem; border-radius: 0.8rem; margin: 0.8rem 0;
        }
        .warning-box {
            background: #fff3cd; color: #856404; padding: 1rem;
            border-radius: 0.6rem; margin: 1.5rem 0; font-size: 0.95rem;
        }
        .loader {
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loadingSplash">
        <div style="text-align:center; color:white;">
            <img src="Image/nursing-logo.png" alt="Logo" style="width:160px; margin-bottom:1rem;">
            <h2>Nursing & Midwifery</h2>
            <p>Student Elections 2026</p>
            <div class="loader"></div>
        </div>
    </div>

    <nav>
        <div class="nav-container">
            <div class="logo">
                <img src="Image/nursing-logo.png" alt="Logo">
                NURSA E-HUB
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="auth-box">

            <!-- LOGIN SECTION -->
            <div id="loginSection" class="section active">
                <h2>Student Login</h2>
                <div id="loginError" class="error-msg"></div>

                <div class="form-group">
                    <label for="loginAccessId">Access ID</label>
                    <input type="text" id="loginAccessId" placeholder="ACCESS-XXXXXXXX" required autocomplete="off">
                </div>

                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required autocomplete="off">
                </div>

                <button id="loginBtn" class="btn">Login</button>

                <div class="links">
                    <a id="showRegisterLink">Register here</a> | 
                    <a id="showForgotLink">Forgot password?</a>
                </div>
            </div>

            <!-- REGISTER SECTION -->
            <div id="registerSection" class="section">
                <h2>Register New Student</h2>
                <div id="registerError" class="error-msg"></div>

                <div class="form-group">
                    <label for="registerStudentId">Student ID</label>
                    <input type="text" id="registerStudentId" placeholder="e.g. 224/5/6MH/MW/NS 01/2000XXX" required autocomplete="off">
                </div>

                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required autocomplete="new-password">
                </div>

                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" required autocomplete="new-password">
                </div>

                <div class="form-group">
                    <label for="registerQuestion">Security Question</label>
                    <input type="text" id="registerQuestion" placeholder="e.g. What is your pet's name?" required autocomplete="off">
                </div>

                <div class="form-group">
                    <label for="registerAnswer">Answer</label>
                    <input type="text" id="registerAnswer" required autocomplete="off">
                </div>

                <button id="registerBtn" class="btn">Register</button>

                <div class="links">
                    <a id="showLoginFromRegister">Already have an account? Login</a>
                </div>
            </div>

            <!-- You can add forgot password section later if needed -->



            <div id="forgotSection" class="section">

                <h2>Reset Password</h2>
                
                <div class="error-msg" id="forgotError"></div>
                
                <div class="form-group">
                
                <label>Student ID</label>
                
                <input type="text" id="forgotStudentId" required>
                
                </div>
                
                <button class="btn" onclick="loadSecurityQuestion()">Get Security Question</button>
                
                <div id="recoveryOptions" style="display:none; margin-top:1.5rem;">
                
                <div class="form-group">
                
                <label id="questionText">Security Question</label>
                
                <input type="text" id="forgotAnswer" placeholder="Your answer">
                
                </div>
                
                <div style="margin:1.5rem 0; text-align:center; font-weight:500;">
                
                                        — OR use your Recovery Code —
                
                </div>
                
                <div class="form-group">
                
                <label>Recovery Code (8 digits)</label>
                
                <input type="text" id="forgotRecoveryCode" placeholder="e.g. 48273915">
                
                </div>
                
                <div class="form-group">
                
                <label>New Password</label>
                
                <input type="password" id="forgotNewPassword">
                
                </div>
                
                <div class="form-group">
                
                <label>Confirm New Password</label>
                
                <input type="password" id="forgotConfirmPassword">
                
                </div>
                
                <button class="btn" onclick="handleResetPassword()">Reset Password</button>
                
                </div>
                
                <div class="links" style="margin-top:1.5rem;">
                
                <a onclick="showSection('loginSection')">Back to Login</a>
                
                </div>
                
                </div>
                
                
                
                
                </div>
                
                </div>
                
                
                
                
                <div id="recoveryModal">
                
                <div class="modal-content">
                
                <h3>Registration Successful!</h3>
                
                <p style="margin-bottom: 1.5rem;">Please save these two codes securely.<br>They are shown <strong>only once</strong>.</p>
                
                
                
                
                <div class="warning-box">
                
                <strong>Access ID</strong> (required for every login)<br>
                
                <div id="accessIdDisplay"></div>
                
                </div>
                
                
                
                
                <div class="warning-box" style="background:#d4edda; color:#155724;">
                
                <strong>Recovery Code</strong> (use only if you forget your password)<br>
                
                <div id="recoveryCodeDisplay"></div>
                
                </div>
                 
                <button class="btn" style="margin-top:2rem;" onclick="document.getElementById('recoveryModal').style.display='none'; showSection('loginSection')">
                
                                I've saved both codes → Go to Login
                
                </button>
                
                </div>
                
                </div>
    <script>
        // ==============================================
        //  SPLASH SCREEN – reliable hide
        // ==============================================
        function hideSplash() {
            const splash = document.getElementById('loadingSplash');
            if (splash) {
                splash.classList.add('hidden');
            }
        }

        // Hide as soon as DOM is ready + small delay
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(hideSplash, 600);
        });

        // Force hide after 5 seconds (safety net)
        setTimeout(hideSplash, 5000);

        // ==============================================
        //  Section switching
        // ==============================================
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            const target = document.getElementById(sectionId);
            if (target) target.classList.add('active');
        }

        // ==============================================
        //  Error helpers
        // ==============================================
        function showError(id, msg) {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = msg;
                el.style.display = 'block';
            } else {
                alert(msg);
            }
        }

        function clearError(id) {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        }

        // ==============================================
        //  LOGIN
        // ==============================================
        document.getElementById('loginBtn')?.addEventListener('click', async () => {
            clearError('loginError');

            const accessId = document.getElementById('loginAccessId')?.value?.trim();
            const password = document.getElementById('loginPassword')?.value;

            if (!accessId || !password) {
                showError('loginError', 'Please enter both Access ID and password');
                return;
            }

            const btn = document.getElementById('loginBtn');
            btn.disabled = true;
            btn.textContent = 'Logging in...';

            try {
                const res = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ accessId, password })
                });

                const data = await res.json();

                if (data.success) {
                    localStorage.setItem('currentStudent', JSON.stringify(data.student));
                    window.location.href = 'dashboard.html';
                } else {
                    showError('loginError', data.message || 'Login failed');
                }
            } catch (err) {
                console.error('Login fetch error:', err);
                showError('loginError', 'Network or server error – try again');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Login';
            }
        });

        // ==============================================
        //  REGISTER
        // ==============================================
        document.getElementById('registerBtn')?.addEventListener('click', async () => {
            clearError('registerError');

            const studentId = document.getElementById('registerStudentId')?.value?.trim();
            const password = document.getElementById('registerPassword')?.value;
            const confirmPassword = document.getElementById('registerConfirmPassword')?.value;
            const question = document.getElementById('registerQuestion')?.value?.trim();
            const answer = document.getElementById('registerAnswer')?.value?.trim();

            if (!studentId || !password || !confirmPassword || !question || !answer) {
                showError('registerError', 'All fields are required');
                return;
            }

            if (password !== confirmPassword) {
                showError('registerError', 'Passwords do not match');
                return;
            }

            const btn = document.getElementById('registerBtn');
            btn.disabled = true;
            btn.textContent = 'Registering...';

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ studentId, password, confirmPassword, question, answer })
                });

                const data = await res.json();

                if (data.success) {
                    alert(
                        `Registration successful!\n\n` +
                        `Access ID: ${data.accessId}\n` +
                        `Recovery Code: ${data.recoveryCode}\n\n` +
                        `SAVE THESE SECURELY – you will need them to log in!`
                    );
                    showSection('loginSection');
                    // Optional: auto-fill access ID for login
                    document.getElementById('loginAccessId').value = data.accessId;
                } else {
                    showError('registerError', data.message || 'Registration failed');
                }
            } catch (err) {
                console.error('Register fetch error:', err);
                showError('registerError', 'Network or server error – try again');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Register';
            }
        });

        // ==============================================
        //  Navigation links
        // ==============================================
        document.getElementById('showRegisterLink')?.addEventListener('click', () => showSection('registerSection'));
        document.getElementById('showLoginFromRegister')?.addEventListener('click', () => showSection('loginSection'));
        // Add forgot password logic later if needed

        // ==============================================
        //  Enter key support
        // ==============================================
        document.addEventListener('keypress', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                if (document.getElementById('loginSection').classList.contains('active')) {
                    document.getElementById('loginBtn')?.click();
                } else if (document.getElementById('registerSection').classList.contains('active')) {
                    document.getElementById('registerBtn')?.click();
                }
            }
        });
    </script>
</body>
</html>